Процедура ПолучитьСделкиИзБитрикс24()

    // Вебхук, выданный Битрикс24
    Вебхук = "https://your_domain.bitrix24.ru/rest/1/abcde12345/"; // замените на ваш

    // Метод API для получения списка сделок
    URLЗапроса = Вебхук + "crm.deal.list";

    // Подготовка параметров запроса (если нужно фильтровать или сортировать)
    ТелоЗапроса = Новый Структура;
    ТелоЗапроса.Вставить("filter", Новый Структура("STAGE_ID", "NEW")); // например, фильтрация по стадии
    ТелоЗапроса.Вставить("select", Новый Массив); // если оставить пустым — вернет все поля

    // Преобразуем структуру в JSON
    ЗаписьJSON = Новый ЗаписьJSON;
    Поток = Новый ЗапоминающийПоток;
    ЗаписьJSON.УстановитьВывод(Поток);
    ЗаписьJSON.ЗаписатьСтруктуру(ТелоЗапроса);
    ЗаписьJSON.Закрыть();
    JSONСтрока = Поток.ПолучитьСтроку();

    // Устанавливаем соединение
    HTTPСоединение = Новый HTTPСоединение("bitrix.npkc-miz.ruyour_domain.bitrix24.ru", 443, , , , Истина);

    // Заголовки
    Заголовки = Новый Соответствие;
    Заголовки.Вставить("Content-Type", "application/json");

    // Выполняем POST-запрос
    Ответ = HTTPСоединение.Выполнить("/rest/1/8qn6fsc2kkfsmjhv/crm.deal.list", "POST", JSONСтрока, Заголовки);

    // Обрабатываем ответ
    Если Ответ.КодСостояния = 200 Тогда
        СтрокаОтвета = Ответ.ПолучитьТелоКакСтроку();
        Сообщить("Ответ от Битрикс24: " + СтрокаОтвета);
    Иначе
        Сообщить("Ошибка при получении сделок: " + Ответ.КодСостояния);
    КонецЕсли;

КонецПроцедуры
